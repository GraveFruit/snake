<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Snake</title>
</head>
<body>

<canvas id="myCanvas" width="400" height="400" style="border:0;">
    Your browser does not support the HTML5 canvas tag.
</canvas>

<script>
    function minIndex(a) {
        if (a > 0)
            return a;
        else
            return 0;
    }

    function drawFruit(grid, fruit) {
        grid[fruit.x][fruit.y] = 2;
    }

    function drawSnake(grid, snake) {
        for (var i = 0; i < snake.length; i++) {
            grid[snake[i].x][snake[i].y] = 1;
        }
    }

    function gridInit(grid) {
        for (var i = 0; i < grid.length; i++) {
            grid[i] = new Array(20);
            for (var j = 0; j < grid[i].length; j++)
                grid[i][j] = 0;
        }
    }

    function moveSnake(snake, xdir, ydir) {
        for (var i = 0; i < snake.length; i++) {
            var segment = snake.pop();
            segment.x += xdir;
            segment.y += ydir;
            snake.unshift(segment);
        }
    }

    function newFruit(fruit, snake, grid, xdir, ydir) {
        var apple = {
            x: Math.floor(Math.random() * 20),
            y: Math.floor(Math.random() * 20)
        }
        apple = fruit;
        var emptySpaces = new Array();


        for (var i = minIndex(apple.x - 1); i <= apple.x + 1; i++)
            for (var j = minIndex(apple.y - 1); j <= apple.y + 1; j++) {
                if (i != snake[0].x + xdir || j != snake[0].y + ydir)
                    if (grid[i][j] == 0)
                        emptySpaces.push({x: i, y: j});
            }
        var rand = Math.floor(Math.random() * emptySpaces.length);
        return {x: emptySpaces[rand].x, y: emptySpaces[rand].y};
    }

    function eatFruit(fruit, snake, xdir, ydir) {
        if(snake[0].x+xdir==fruit.x&& snake[0].y+ydir==fruit.y){
            snake.unshift(fruit);
            return true;
        }
        return false;

    }

    function collisionCheck(snake) {
        var collision = false;
        for (var i = 0; i < snake.length - 1; i++)
            for (var j = i + 1; j < snake.length; j++) {
                if (snake[i].x == snake[j].x && snake[i].y == snake[j].y) {
                    collision = true;
                    break;
                }

            }
        return collision;
    }

    function drawGrid(grid) {
        for (var i = 0; i < 20; i++)
            for (var j = 0; j < 20; j++) {
                if (grid[i][j] == 1)
                    ctx.fillStyle = "#00bc2a";
                else if (grid[i][j] == 2)
                    ctx.fillStyle = "#bc2e14";
                else
                    ctx.fillStyle = "#e7e9dc";
                ctx.fillRect(20 * i, 20 * j, 20, 20);
                ctx.stroke();
            }
    }

    var xdir = 1;
    var ydir = 0;
    var snake = new Array();
    var segment = {
        x: 10,
        y: 10
    }
    snake.unshift(segment);
    var fruit = {
        x: 10,
        y: 10
    }
    var grid = new Array(20);
    var c = document.getElementById("myCanvas");
    var ctx = c.getContext("2d");


    gridInit(grid);

    if(collisionCheck(snake)){
        //break;
    }
    drawSnake(grid, snake);
    
    fruit = newFruit(fruit, snake, grid, xdir, ydir);
    moveSnake(snake, xdir, ydir);
    drawFruit(grid, fruit);
    drawGrid(grid);

    console.log(collisionCheck(snake));

</script>

</body>
</html>